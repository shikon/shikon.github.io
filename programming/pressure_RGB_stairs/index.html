<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>RGB lights even on your stairs - Shiko</title>
<meta name="description" content="RGB on stairs that is boring  Is what you might think. But let’s spice it up a bit by making them user aware. Okay, let’s put a motion sensor nearby and this activated the lights when you are in the vicinity. Well… no it can be even cooler, how about making it stair-step-aware?!  stair-step-awareness  Wouldn’t it be cool if the stairs would light up exactly on your current step? I think it would be and that is exactly the goal of today. Towards this, I designed a custom system that adds some flair to your stairs! It consists of three main components,     Addressable RGB led-strip   Step presence detection   Controller   Addressable RGB led-strip  To look cool I didn’t opt for just a white led-strip but an RGB one that is individually addressable, because we want to do cool things with it… Such as stair-step awareness (SSA). Our stairs have 12 steps each of approximate length of 1 meter. This means I need 12 meters of LED strip, luckily due to mass fabrication these can be and are quite cheap, but what should one choose? It depends on a few factors but I mainly concentrated on,  Voltage drop on an RGB led-strip and my choice  The main factor to consider here is that at 12 meters in length the voltage drop can be quite significant, hence choosing LED chips that work with a higher operation voltage are more convenient to use. Why is this? Consider for similar LED efficiency (the same amount of energy is required to give a certain amount of light), the power is constant then for LED with higher operation voltage less current is required. Then by Ohm’s law \(V_{drop} = I^2R\) is lower for LEDs with higher operating voltage. This means the LED strip will not become dim over its length. Additionally, one could opt to connect the power source at regular intervals on the total LED strip, however this requires additional wire and floor planning. Therefore, it is better to choose a more suitable LED strip. The most common options are, 5 V and 12 V. Since 5 V is the lowest option here, 12 V is preferred because of the lower voltage drop. This made my choice to fall on the WS2811 the higher voltage brother of the WS2812B which is common in many projects.  Brightness, trueness of color and power consumption, etc.  In the end there are many more factors to consider. Some LED strips are better in some of the factors but in the end the WS2811 was the cheapest per meter and suited my needs. Some alternatives are, SK6812 and APA102.  Step presence detection  To achieve the SSA, we need to somehow know when someone is on a step. Let’s consider some mechanics and imagine you are standing on a stair-step. When you step on a step, your foot is on the step. This induces pressure but also your foot is physically there. I came up with the two following mechanisms to detect the presence on a certain step.     Light-blocking   Pressure   Light-blocking  When your foot is on the step it is physically there. This means if there is a light sensor it would be blocked off by your foot. This could be sideways or in the step itself as depicted here.   These methods have a few cons, for sideways you would require an additional light source. For in you can use your natural lighting such as diffuse light, however, this would not work very well at night. Also, the intensity can vary over the day so you would need some automatic calibration to distinguish between low light or ‘is being stepped on’ conditions.  Pressure  Since the light-blocking method is possible. I deemed it too complex to do, so I thought of an alternative. Where I use pressure sensors and with this in my I went ahead and found two types of pressure sensors     Strain-gauge   Thin-film pressure sensor   The strain gauge required me to glue them on the backside of the stairs. In that way, it can bend together with the wood and hence measure presence. This required a lot of glue and modifications so I did not prefer this.  Whereas thin films can be placed very unobtrusively onto the stair-step. Since we were planning to use stair nosings profiles, they could be perfectly hidden underneath them. These sensors have huge resistance and once it compresses the resistance decreases. So the controller needs to read the resistance in some smart way to detect presence. More on that below…  Controller  In this project I needed two main functionalities to be achieved by this controller.  1) The controller knows which step I am standing on, SSA 2) Correct color is sent to the RGB led-strip  One of the most known microcontrollers is the Arduino since it is so popular a lot of libraries are created for it and this makes my life a lot easier. Less time spent on re-inventing the wheel is more time to do cool projects. But, not only software is needed but also hardware since we are using real physical sensors.  Thin-film pressure sensor readout  The circuitry that is used is very simple, there are two states. Either you are on the step or you are not on the step. These two states can be distinguished by looking at the resistance of the sensor, this means we need to distinguish between high and low resistance states. As mentioned before the resistance decreases if it is compressed hence it makes sense to choose everything below a certain threshold, that is the on the step state and everything above is not on the step state.  Comparator to sense the state  To achieve state readout we can use a comparator, which can be explained with the following image,    It basically does what I explained before, if you use a 5 V supply it makes sense to set \(V_{REF} = 2.5V\) and thus choose the resistors equally. However, since I have 12 steps I have to do this 12x?  Time multiplexing is less hardware  Since OPAMPs are not very cheap ~ €1,- a piece and the number of control pins on the Arduino is limited I chose to do time multiplexing. In time-multiplexing I make use of the fact that I don’t need to constantly know whether someone is on the step, but only once in a while. The Arduino’s clock frequency is 32 MHz so I could read out my stairs at MHz speeds which means million times per second. But I don’t need to know it that often hence I could easily divide this by 12 and read all 12 steps with time multiplexing.  Electronics schema for LED controller PCB  To achieve all of the hardware functionalities I created a small PCB that neatly packs everything together, with its schema below    A few things to note from left to right and up to down.     I used a DC-DC converter so I could use a single supply for LED and my controller PCB.   Some external connector to connect to the LED strip and also control a relay if needed   Time multiplexing where W0-W11 are the pressure sensors and IC1 is the multiplexing chip   Biasing for the comparator circuit achieved with OPAMP            R4 series resistor to prevent short circuits of the weight sensor       R1 is a pulldown resistor           The Arduino, pro mini because it is cheap   --- **NOTE** The labels with same name means they are connected together ---   Arduino code for controller  To make everything work together of course code is needed. So the software has these functionalities, when the presence is detected it turns all the lights on to CRGB on(122,122,122). The step above your current step will be set to CRGB stepColordown(255,0,0) and the step below your current step will be CRGB stepColorup(0,255,0). After it turns on and the presence is gone, it will fade to CRGB bgColor( 122, 122, 122) and after 15 seconds it will fade to no light CRGB off(0,0,0).  The main things to change to your needs is in the first few lines,  #include &lt;Arduino.h&gt; #include &quot;FastLED.h&quot; #include &quot;Mux.h&quot;  using namespace admux;  // Hardware settings CHANGE THIS #define NUM_LEDS 16 //number leds per step (16) #define NUM_STEPS 12 //number of steps #define STOP_TIME 15000 //after this time turn it off  //init mux object Mux mux(admux::Pin(A0, INPUT, PinType::Analog), Pinset(2,3,4,5)); // need admux:: because pin doubly defined  #define detectPin 14 // pin connected to output of comparator/OPAMP #define enPin 17 //pin for relay #define DATA_PIN 9 //pin that is connected to led strip  #define TOT_LEDS NUM_LEDS*NUM_STEPS  //time keepers unsigned long start=0, stop=0; CRGB leds[TOT_LEDS]; //set your colors CRGB stepColordown(255,0,0); CRGB stepColorup(0,255,0); CRGB bgColor( 122, 122, 122); //white CRGB off(0,0,0); CRGB on(122,122,122); // NO CHANGES NEEDED BELOW except color order in setup() int detected=0; int channelDetected = 0;  // Helper function that blends one uint8_t toward another by a given amount void nblendU8TowardU8( uint8_t&amp; cur, const uint8_t target, uint8_t amount) {   if( cur == target) return;      if( cur &lt; target ) {     uint8_t delta = target - cur;     delta = scale8_video( delta, amount);     cur += delta;   } else {     uint8_t delta = cur - target;     delta = scale8_video( delta, amount);     cur -= delta;   } }  // Blend one CRGB color toward another CRGB color by a given amount. // Blending is linear, and done in the RGB color space. // This function modifies &#39;cur&#39; in place. CRGB fadeLedtoColor( CRGB&amp; cur, const CRGB&amp; target, uint8_t amount) {   nblendU8TowardU8( cur.red,   target.red,   amount);   nblendU8TowardU8( cur.green, target.green, amount);   nblendU8TowardU8( cur.blue,  target.blue,  amount);   return cur; } // Fade an entire array of CRGBs toward a given background color by a given amount // This function modifies the pixel array in place. void fadeSteptoColor(uint16_t step, CRGB* L, uint16_t N, const CRGB&amp; bgColor, uint8_t fadeAmount){     for(unsigned int j = 0; j &lt; N; j++){ // N is number of leds per step to fade     fadeLedtoColor(L[step*N+j], bgColor, fadeAmount);   } }  void fadeAllstepsTocolor(CRGB* L, uint16_t N, const CRGB&amp; bgColor, uint8_t fadeAmount, uint16_t noofsteps){   for( uint16_t i = 0; i &lt; noofsteps; i++){     fadeSteptoColor(i, L, N, bgColor, fadeAmount);   } }  int readChannel(int chnl){   int16_t data;    mux.channel(chnl);   delay(5); //don&#39;t need full speed let it settle   data = mux.read();   Serial.print(&quot;Potentiometer at channel &quot;); Serial.print(chnl); Serial.print(&quot; is at &quot;); Serial.print((double) (data) * 100 / 1023); Serial.println(&quot;%%&quot;);   if(data &gt; 511) return chnl + 1;   else return 0; }  void changeSteplight(int step, CRGB&amp; color){   for(int j = 0; j &lt; NUM_LEDS; j++){     leds[step*NUM_LEDS+j] = color;   } }  void setAllotherSteps(int mystep, CRGB myColor){   int i = mystep;   for(unsigned int j = 1; i+j&lt;NUM_STEPS; j++){     changeSteplight(i+j, myColor);   }   for(unsigned int j = 1; i-j+1&gt;0; j++){     changeSteplight(i-j,myColor);   } }  void setAllsteps(int mystep, CRGB myColor){   for (int i = 0; i &lt; NUM_STEPS; i++){     changeSteplight(i, myColor);   } }  void setup() {   pinMode(enPin, OUTPUT);   pinMode(detectPin, INPUT);   pinMode(LED_BUILTIN, OUTPUT);   digitalWrite(LED_BUILTIN, LOW);   digitalWrite(enPin, LOW);   FastLED.addLeds&lt;WS2811, DATA_PIN, BRG&gt;(leds, TOT_LEDS); //set your color order for me BRG }  void loop() {    for (int i = 0; i &lt; NUM_STEPS; i++){     channelDetected = readChannel(i);     if(channelDetected){       digitalWrite(LED_BUILTIN, HIGH); //T       detected++;       start = millis();       setAllsteps(i, bgColor);       changeSteplight(i,stepColordown);       if(channelDetected &gt; 2) changeSteplight(i-2,stepColorup); //note that if channeldetected = 1, i = 0     }   }   if(detected){     fadeAllstepsTocolor(leds, NUM_LEDS, bgColor, 1, 5);   }   if(millis() - start &gt; STOP_TIME){ // keep lights on for set time     detected = 0;     //FastLED.clear(); // hard turn off     fadeAllstepsTocolor(leds, NUM_LEDS, off, 1, NUM_STEPS); //soft turn off   }   FastLED.show();  }   Final words  Well enjoy that all :)  Learnings and references     Consider not only the number stair-step but also one more which is even to the floor.   It is a pain to make so many long connectors, 12 sensors…   The blending function">


  <meta name="author" content="Lan Hu">
  
  <meta property="article:author" content="Lan Hu">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Shiko">
<meta property="og:title" content="RGB lights even on your stairs">
<meta property="og:url" content="https://shiko.nl/programming/pressure_RGB_stairs/">


  <meta property="og:description" content="RGB on stairs that is boring  Is what you might think. But let’s spice it up a bit by making them user aware. Okay, let’s put a motion sensor nearby and this activated the lights when you are in the vicinity. Well… no it can be even cooler, how about making it stair-step-aware?!  stair-step-awareness  Wouldn’t it be cool if the stairs would light up exactly on your current step? I think it would be and that is exactly the goal of today. Towards this, I designed a custom system that adds some flair to your stairs! It consists of three main components,     Addressable RGB led-strip   Step presence detection   Controller   Addressable RGB led-strip  To look cool I didn’t opt for just a white led-strip but an RGB one that is individually addressable, because we want to do cool things with it… Such as stair-step awareness (SSA). Our stairs have 12 steps each of approximate length of 1 meter. This means I need 12 meters of LED strip, luckily due to mass fabrication these can be and are quite cheap, but what should one choose? It depends on a few factors but I mainly concentrated on,  Voltage drop on an RGB led-strip and my choice  The main factor to consider here is that at 12 meters in length the voltage drop can be quite significant, hence choosing LED chips that work with a higher operation voltage are more convenient to use. Why is this? Consider for similar LED efficiency (the same amount of energy is required to give a certain amount of light), the power is constant then for LED with higher operation voltage less current is required. Then by Ohm’s law \(V_{drop} = I^2R\) is lower for LEDs with higher operating voltage. This means the LED strip will not become dim over its length. Additionally, one could opt to connect the power source at regular intervals on the total LED strip, however this requires additional wire and floor planning. Therefore, it is better to choose a more suitable LED strip. The most common options are, 5 V and 12 V. Since 5 V is the lowest option here, 12 V is preferred because of the lower voltage drop. This made my choice to fall on the WS2811 the higher voltage brother of the WS2812B which is common in many projects.  Brightness, trueness of color and power consumption, etc.  In the end there are many more factors to consider. Some LED strips are better in some of the factors but in the end the WS2811 was the cheapest per meter and suited my needs. Some alternatives are, SK6812 and APA102.  Step presence detection  To achieve the SSA, we need to somehow know when someone is on a step. Let’s consider some mechanics and imagine you are standing on a stair-step. When you step on a step, your foot is on the step. This induces pressure but also your foot is physically there. I came up with the two following mechanisms to detect the presence on a certain step.     Light-blocking   Pressure   Light-blocking  When your foot is on the step it is physically there. This means if there is a light sensor it would be blocked off by your foot. This could be sideways or in the step itself as depicted here.   These methods have a few cons, for sideways you would require an additional light source. For in you can use your natural lighting such as diffuse light, however, this would not work very well at night. Also, the intensity can vary over the day so you would need some automatic calibration to distinguish between low light or ‘is being stepped on’ conditions.  Pressure  Since the light-blocking method is possible. I deemed it too complex to do, so I thought of an alternative. Where I use pressure sensors and with this in my I went ahead and found two types of pressure sensors     Strain-gauge   Thin-film pressure sensor   The strain gauge required me to glue them on the backside of the stairs. In that way, it can bend together with the wood and hence measure presence. This required a lot of glue and modifications so I did not prefer this.  Whereas thin films can be placed very unobtrusively onto the stair-step. Since we were planning to use stair nosings profiles, they could be perfectly hidden underneath them. These sensors have huge resistance and once it compresses the resistance decreases. So the controller needs to read the resistance in some smart way to detect presence. More on that below…  Controller  In this project I needed two main functionalities to be achieved by this controller.  1) The controller knows which step I am standing on, SSA 2) Correct color is sent to the RGB led-strip  One of the most known microcontrollers is the Arduino since it is so popular a lot of libraries are created for it and this makes my life a lot easier. Less time spent on re-inventing the wheel is more time to do cool projects. But, not only software is needed but also hardware since we are using real physical sensors.  Thin-film pressure sensor readout  The circuitry that is used is very simple, there are two states. Either you are on the step or you are not on the step. These two states can be distinguished by looking at the resistance of the sensor, this means we need to distinguish between high and low resistance states. As mentioned before the resistance decreases if it is compressed hence it makes sense to choose everything below a certain threshold, that is the on the step state and everything above is not on the step state.  Comparator to sense the state  To achieve state readout we can use a comparator, which can be explained with the following image,    It basically does what I explained before, if you use a 5 V supply it makes sense to set \(V_{REF} = 2.5V\) and thus choose the resistors equally. However, since I have 12 steps I have to do this 12x?  Time multiplexing is less hardware  Since OPAMPs are not very cheap ~ €1,- a piece and the number of control pins on the Arduino is limited I chose to do time multiplexing. In time-multiplexing I make use of the fact that I don’t need to constantly know whether someone is on the step, but only once in a while. The Arduino’s clock frequency is 32 MHz so I could read out my stairs at MHz speeds which means million times per second. But I don’t need to know it that often hence I could easily divide this by 12 and read all 12 steps with time multiplexing.  Electronics schema for LED controller PCB  To achieve all of the hardware functionalities I created a small PCB that neatly packs everything together, with its schema below    A few things to note from left to right and up to down.     I used a DC-DC converter so I could use a single supply for LED and my controller PCB.   Some external connector to connect to the LED strip and also control a relay if needed   Time multiplexing where W0-W11 are the pressure sensors and IC1 is the multiplexing chip   Biasing for the comparator circuit achieved with OPAMP            R4 series resistor to prevent short circuits of the weight sensor       R1 is a pulldown resistor           The Arduino, pro mini because it is cheap   --- **NOTE** The labels with same name means they are connected together ---   Arduino code for controller  To make everything work together of course code is needed. So the software has these functionalities, when the presence is detected it turns all the lights on to CRGB on(122,122,122). The step above your current step will be set to CRGB stepColordown(255,0,0) and the step below your current step will be CRGB stepColorup(0,255,0). After it turns on and the presence is gone, it will fade to CRGB bgColor( 122, 122, 122) and after 15 seconds it will fade to no light CRGB off(0,0,0).  The main things to change to your needs is in the first few lines,  #include &lt;Arduino.h&gt; #include &quot;FastLED.h&quot; #include &quot;Mux.h&quot;  using namespace admux;  // Hardware settings CHANGE THIS #define NUM_LEDS 16 //number leds per step (16) #define NUM_STEPS 12 //number of steps #define STOP_TIME 15000 //after this time turn it off  //init mux object Mux mux(admux::Pin(A0, INPUT, PinType::Analog), Pinset(2,3,4,5)); // need admux:: because pin doubly defined  #define detectPin 14 // pin connected to output of comparator/OPAMP #define enPin 17 //pin for relay #define DATA_PIN 9 //pin that is connected to led strip  #define TOT_LEDS NUM_LEDS*NUM_STEPS  //time keepers unsigned long start=0, stop=0; CRGB leds[TOT_LEDS]; //set your colors CRGB stepColordown(255,0,0); CRGB stepColorup(0,255,0); CRGB bgColor( 122, 122, 122); //white CRGB off(0,0,0); CRGB on(122,122,122); // NO CHANGES NEEDED BELOW except color order in setup() int detected=0; int channelDetected = 0;  // Helper function that blends one uint8_t toward another by a given amount void nblendU8TowardU8( uint8_t&amp; cur, const uint8_t target, uint8_t amount) {   if( cur == target) return;      if( cur &lt; target ) {     uint8_t delta = target - cur;     delta = scale8_video( delta, amount);     cur += delta;   } else {     uint8_t delta = cur - target;     delta = scale8_video( delta, amount);     cur -= delta;   } }  // Blend one CRGB color toward another CRGB color by a given amount. // Blending is linear, and done in the RGB color space. // This function modifies &#39;cur&#39; in place. CRGB fadeLedtoColor( CRGB&amp; cur, const CRGB&amp; target, uint8_t amount) {   nblendU8TowardU8( cur.red,   target.red,   amount);   nblendU8TowardU8( cur.green, target.green, amount);   nblendU8TowardU8( cur.blue,  target.blue,  amount);   return cur; } // Fade an entire array of CRGBs toward a given background color by a given amount // This function modifies the pixel array in place. void fadeSteptoColor(uint16_t step, CRGB* L, uint16_t N, const CRGB&amp; bgColor, uint8_t fadeAmount){     for(unsigned int j = 0; j &lt; N; j++){ // N is number of leds per step to fade     fadeLedtoColor(L[step*N+j], bgColor, fadeAmount);   } }  void fadeAllstepsTocolor(CRGB* L, uint16_t N, const CRGB&amp; bgColor, uint8_t fadeAmount, uint16_t noofsteps){   for( uint16_t i = 0; i &lt; noofsteps; i++){     fadeSteptoColor(i, L, N, bgColor, fadeAmount);   } }  int readChannel(int chnl){   int16_t data;    mux.channel(chnl);   delay(5); //don&#39;t need full speed let it settle   data = mux.read();   Serial.print(&quot;Potentiometer at channel &quot;); Serial.print(chnl); Serial.print(&quot; is at &quot;); Serial.print((double) (data) * 100 / 1023); Serial.println(&quot;%%&quot;);   if(data &gt; 511) return chnl + 1;   else return 0; }  void changeSteplight(int step, CRGB&amp; color){   for(int j = 0; j &lt; NUM_LEDS; j++){     leds[step*NUM_LEDS+j] = color;   } }  void setAllotherSteps(int mystep, CRGB myColor){   int i = mystep;   for(unsigned int j = 1; i+j&lt;NUM_STEPS; j++){     changeSteplight(i+j, myColor);   }   for(unsigned int j = 1; i-j+1&gt;0; j++){     changeSteplight(i-j,myColor);   } }  void setAllsteps(int mystep, CRGB myColor){   for (int i = 0; i &lt; NUM_STEPS; i++){     changeSteplight(i, myColor);   } }  void setup() {   pinMode(enPin, OUTPUT);   pinMode(detectPin, INPUT);   pinMode(LED_BUILTIN, OUTPUT);   digitalWrite(LED_BUILTIN, LOW);   digitalWrite(enPin, LOW);   FastLED.addLeds&lt;WS2811, DATA_PIN, BRG&gt;(leds, TOT_LEDS); //set your color order for me BRG }  void loop() {    for (int i = 0; i &lt; NUM_STEPS; i++){     channelDetected = readChannel(i);     if(channelDetected){       digitalWrite(LED_BUILTIN, HIGH); //T       detected++;       start = millis();       setAllsteps(i, bgColor);       changeSteplight(i,stepColordown);       if(channelDetected &gt; 2) changeSteplight(i-2,stepColorup); //note that if channeldetected = 1, i = 0     }   }   if(detected){     fadeAllstepsTocolor(leds, NUM_LEDS, bgColor, 1, 5);   }   if(millis() - start &gt; STOP_TIME){ // keep lights on for set time     detected = 0;     //FastLED.clear(); // hard turn off     fadeAllstepsTocolor(leds, NUM_LEDS, off, 1, NUM_STEPS); //soft turn off   }   FastLED.show();  }   Final words  Well enjoy that all :)  Learnings and references     Consider not only the number stair-step but also one more which is even to the floor.   It is a pain to make so many long connectors, 12 sensors…   The blending function">



  <meta property="og:image" content="https://shiko.nl/assets/images/site-logo.png">





  <meta property="article:published_time" content="2022-05-22T00:00:00+02:00">





  

  


<link rel="canonical" href="https://shiko.nl/programming/pressure_RGB_stairs/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Lan Hu",
      "url": "https://shiko.nl/",
      "sameAs": ["https://github.com/shikon"]
    
  }
</script>


  <meta name="google-site-verification" content="UQj93ERU9zgECodaaXgVpkjrFn9UrDMEzVamacSoQ8Y" />






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Shiko Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/images/favicons/site.webmanifest">
<link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt="Shiko"></a>
        
        <a class="site-title" href="/">
          Shiko
          <span class="site-subtitle">Life is an unique journey</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<!-- Courtesy of embedresponsively.com //-->

  <div class="responsive-video-container">
    <iframe src="https://www.youtube-nocookie.com/embed/dtrTB0RgnRo" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowfullscreen></iframe>
  </div>







<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/me.jpg" alt="Lan Hu" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Lan Hu</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>A student of life, multi-faceted, tries to master his trades.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Noord-Brabant, NL</span>
        </li>
      

      
        
          
            <li><a href="mailto:lan@shiko.nl" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/shikon" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/lanhu" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">Linkedin</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="RGB lights even on your stairs">
    <meta itemprop="description" content="RGB on stairs that is boringIs what you might think. But let’s spice it up a bit by making them user aware. Okay, let’s put a motion sensor nearby and this activated the lights when you are in the vicinity. Well… no it can be even cooler, how about making it stair-step-aware?!stair-step-awarenessWouldn’t it be cool if the stairs would light up exactly on your current step? I think it would be and that is exactly the goal of today. Towards this, I designed a custom system that adds some flair to your stairs! It consists of three main components,  Addressable RGB led-strip  Step presence detection  ControllerAddressable RGB led-stripTo look cool I didn’t opt for just a white led-strip but an RGB one that is individually addressable, because we want to do cool things with it… Such as stair-step awareness (SSA). Our stairs have 12 steps each of approximate length of 1 meter. This means I need 12 meters of LED strip, luckily due to mass fabrication these can be and are quite cheap, but what should one choose? It depends on a few factors but I mainly concentrated on,Voltage drop on an RGB led-strip and my choiceThe main factor to consider here is that at 12 meters in length the voltage drop can be quite significant, hence choosing LED chips that work with a higher operation voltage are more convenient to use. Why is this? Consider for similar LED efficiency (the same amount of energy is required to give a certain amount of light), the power is constant then for LED with higher operation voltage less current is required. Then by Ohm’s law \(V_{drop} = I^2R\) is lower for LEDs with higher operating voltage. This means the LED strip will not become dim over its length. Additionally, one could opt to connect the power source at regular intervals on the total LED strip, however this requires additional wire and floor planning. Therefore, it is better to choose a more suitable LED strip. The most common options are, 5 V and 12 V. Since 5 V is the lowest option here, 12 V is preferred because of the lower voltage drop. This made my choice to fall on the WS2811 the higher voltage brother of the WS2812B which is common in many projects.Brightness, trueness of color and power consumption, etc.In the end there are many more factors to consider. Some LED strips are better in some of the factors but in the end the WS2811 was the cheapest per meter and suited my needs. Some alternatives are, SK6812 and APA102.Step presence detectionTo achieve the SSA, we need to somehow know when someone is on a step. Let’s consider some mechanics and imagine you are standing on a stair-step. When you step on a step, your foot is on the step. This induces pressure but also your foot is physically there. I came up with the two following mechanisms to detect the presence on a certain step.  Light-blocking  PressureLight-blockingWhen your foot is on the step it is physically there. This means if there is a light sensor it would be blocked off by your foot. This could be sideways or in the step itself as depicted here. These methods have a few cons, for sideways you would require an additional light source. For in you can use your natural lighting such as diffuse light, however, this would not work very well at night. Also, the intensity can vary over the day so you would need some automatic calibration to distinguish between low light or ‘is being stepped on’ conditions.PressureSince the light-blocking method is possible. I deemed it too complex to do, so I thought of an alternative. Where I use pressure sensors and with this in my I went ahead and found two types of pressure sensors  Strain-gauge  Thin-film pressure sensorThe strain gauge required me to glue them on the backside of the stairs. In that way, it can bend together with the wood and hence measure presence. This required a lot of glue and modifications so I did not prefer this.Whereas thin films can be placed very unobtrusively onto the stair-step. Since we were planning to use stair nosings profiles, they could be perfectly hidden underneath them. These sensors have huge resistance and once it compresses the resistance decreases. So the controller needs to read the resistance in some smart way to detect presence. More on that below…ControllerIn this project I needed two main functionalities to be achieved by this controller.1) The controller knows which step I am standing on, SSA2) Correct color is sent to the RGB led-stripOne of the most known microcontrollers is the Arduino since it is so popular a lot of libraries are created for it and this makes my life a lot easier. Less time spent on re-inventing the wheel is more time to do cool projects. But, not only software is needed but also hardware since we are using real physical sensors.Thin-film pressure sensor readoutThe circuitry that is used is very simple, there are two states. Either you are on the step or you are not on the step. These two states can be distinguished by looking at the resistance of the sensor, this means we need to distinguish between high and low resistance states. As mentioned before the resistance decreases if it is compressed hence it makes sense to choose everything below a certain threshold, that is the on the step state and everything above is not on the step state.Comparator to sense the stateTo achieve state readout we can use a comparator, which can be explained with the following image,It basically does what I explained before, if you use a 5 V supply it makes sense to set \(V_{REF} = 2.5V\) and thus choose the resistors equally. However, since I have 12 steps I have to do this 12x?Time multiplexing is less hardwareSince OPAMPs are not very cheap ~ €1,- a piece and the number of control pins on the Arduino is limited I chose to do time multiplexing. In time-multiplexing I make use of the fact that I don’t need to constantly know whether someone is on the step, but only once in a while. The Arduino’s clock frequency is 32 MHz so I could read out my stairs at MHz speeds which means million times per second. But I don’t need to know it that often hence I could easily divide this by 12 and read all 12 steps with time multiplexing.Electronics schema for LED controller PCBTo achieve all of the hardware functionalities I created a small PCB that neatly packs everything together, with its schema belowA few things to note from left to right and up to down.  I used a DC-DC converter so I could use a single supply for LED and my controller PCB.  Some external connector to connect to the LED strip and also control a relay if needed  Time multiplexing where W0-W11 are the pressure sensors and IC1 is the multiplexing chip  Biasing for the comparator circuit achieved with OPAMP          R4 series resistor to prevent short circuits of the weight sensor      R1 is a pulldown resistor        The Arduino, pro mini because it is cheap---**NOTE**The labels with same name means they are connected together---Arduino code for controllerTo make everything work together of course code is needed. So the software has these functionalities, when the presence is detected it turns all the lights on to CRGB on(122,122,122). The step above your current step will be set to CRGB stepColordown(255,0,0) and the step below your current step will be CRGB stepColorup(0,255,0). After it turns on and the presence is gone, it will fade to CRGB bgColor( 122, 122, 122) and after 15 seconds it will fade to no light CRGB off(0,0,0).The main things to change to your needs is in the first few lines,#include &lt;Arduino.h&gt;#include &quot;FastLED.h&quot;#include &quot;Mux.h&quot;using namespace admux;// Hardware settings CHANGE THIS#define NUM_LEDS 16 //number leds per step (16)#define NUM_STEPS 12 //number of steps#define STOP_TIME 15000 //after this time turn it off//init mux objectMux mux(admux::Pin(A0, INPUT, PinType::Analog), Pinset(2,3,4,5)); // need admux:: because pin doubly defined#define detectPin 14 // pin connected to output of comparator/OPAMP#define enPin 17 //pin for relay#define DATA_PIN 9 //pin that is connected to led strip#define TOT_LEDS NUM_LEDS*NUM_STEPS//time keepersunsigned long start=0, stop=0;CRGB leds[TOT_LEDS];//set your colorsCRGB stepColordown(255,0,0);CRGB stepColorup(0,255,0);CRGB bgColor( 122, 122, 122); //whiteCRGB off(0,0,0);CRGB on(122,122,122);// NO CHANGES NEEDED BELOW except color order in setup()int detected=0;int channelDetected = 0;// Helper function that blends one uint8_t toward another by a given amountvoid nblendU8TowardU8( uint8_t&amp; cur, const uint8_t target, uint8_t amount){  if( cur == target) return;    if( cur &lt; target ) {    uint8_t delta = target - cur;    delta = scale8_video( delta, amount);    cur += delta;  } else {    uint8_t delta = cur - target;    delta = scale8_video( delta, amount);    cur -= delta;  }}// Blend one CRGB color toward another CRGB color by a given amount.// Blending is linear, and done in the RGB color space.// This function modifies &#39;cur&#39; in place.CRGB fadeLedtoColor( CRGB&amp; cur, const CRGB&amp; target, uint8_t amount){  nblendU8TowardU8( cur.red,   target.red,   amount);  nblendU8TowardU8( cur.green, target.green, amount);  nblendU8TowardU8( cur.blue,  target.blue,  amount);  return cur;}// Fade an entire array of CRGBs toward a given background color by a given amount// This function modifies the pixel array in place.void fadeSteptoColor(uint16_t step, CRGB* L, uint16_t N, const CRGB&amp; bgColor, uint8_t fadeAmount){    for(unsigned int j = 0; j &lt; N; j++){ // N is number of leds per step to fade    fadeLedtoColor(L[step*N+j], bgColor, fadeAmount);  }}void fadeAllstepsTocolor(CRGB* L, uint16_t N, const CRGB&amp; bgColor, uint8_t fadeAmount, uint16_t noofsteps){  for( uint16_t i = 0; i &lt; noofsteps; i++){    fadeSteptoColor(i, L, N, bgColor, fadeAmount);  }}int readChannel(int chnl){  int16_t data;  mux.channel(chnl);  delay(5); //don&#39;t need full speed let it settle  data = mux.read();  Serial.print(&quot;Potentiometer at channel &quot;); Serial.print(chnl); Serial.print(&quot; is at &quot;); Serial.print((double) (data) * 100 / 1023); Serial.println(&quot;%%&quot;);  if(data &gt; 511) return chnl + 1;  else return 0;}void changeSteplight(int step, CRGB&amp; color){  for(int j = 0; j &lt; NUM_LEDS; j++){    leds[step*NUM_LEDS+j] = color;  }}void setAllotherSteps(int mystep, CRGB myColor){  int i = mystep;  for(unsigned int j = 1; i+j&lt;NUM_STEPS; j++){    changeSteplight(i+j, myColor);  }  for(unsigned int j = 1; i-j+1&gt;0; j++){    changeSteplight(i-j,myColor);  }}void setAllsteps(int mystep, CRGB myColor){  for (int i = 0; i &lt; NUM_STEPS; i++){    changeSteplight(i, myColor);  }}void setup() {  pinMode(enPin, OUTPUT);  pinMode(detectPin, INPUT);  pinMode(LED_BUILTIN, OUTPUT);  digitalWrite(LED_BUILTIN, LOW);  digitalWrite(enPin, LOW);  FastLED.addLeds&lt;WS2811, DATA_PIN, BRG&gt;(leds, TOT_LEDS); //set your color order for me BRG}void loop() {  for (int i = 0; i &lt; NUM_STEPS; i++){    channelDetected = readChannel(i);    if(channelDetected){      digitalWrite(LED_BUILTIN, HIGH); //T      detected++;      start = millis();      setAllsteps(i, bgColor);      changeSteplight(i,stepColordown);      if(channelDetected &gt; 2) changeSteplight(i-2,stepColorup); //note that if channeldetected = 1, i = 0    }  }  if(detected){    fadeAllstepsTocolor(leds, NUM_LEDS, bgColor, 1, 5);  }  if(millis() - start &gt; STOP_TIME){ // keep lights on for set time    detected = 0;    //FastLED.clear(); // hard turn off    fadeAllstepsTocolor(leds, NUM_LEDS, off, 1, NUM_STEPS); //soft turn off  }  FastLED.show(); }Final wordsWell enjoy that all :)Learnings and references  Consider not only the number stair-step but also one more which is even to the floor.  It is a pain to make so many long connectors, 12 sensors…The blending function">
    <meta itemprop="datePublished" content="2022-05-22T00:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">RGB lights even on your stairs
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          12 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#rgb-on-stairs-that-is-boring">RGB on stairs that is boring</a><ul><li><a href="#stair-step-awareness">stair-step-awareness</a></li></ul></li><li><a href="#addressable-rgb-led-strip">Addressable RGB led-strip</a><ul><li><a href="#voltage-drop-on-an-rgb-led-strip-and-my-choice">Voltage drop on an RGB led-strip and my choice</a></li><li><a href="#brightness-trueness-of-color-and-power-consumption-etc">Brightness, trueness of color and power consumption, etc.</a></li></ul></li><li><a href="#step-presence-detection">Step presence detection</a><ul><li><a href="#light-blocking">Light-blocking</a></li><li><a href="#pressure">Pressure</a></li></ul></li><li><a href="#controller">Controller</a><ul><li><a href="#thin-film-pressure-sensor-readout">Thin-film pressure sensor readout</a></li><li><a href="#comparator-to-sense-the-state">Comparator to sense the state</a></li><li><a href="#time-multiplexing-is-less-hardware">Time multiplexing is less hardware</a></li><li><a href="#electronics-schema-for-led-controller-pcb">Electronics schema for LED controller PCB</a></li><li><a href="#arduino-code-for-controller">Arduino code for controller</a></li></ul></li><li><a href="#final-words">Final words</a></li><li><a href="#learnings-and-references">Learnings and references</a></li></ul>

            </nav>
          </aside>
        
        <h1 id="rgb-on-stairs-that-is-boring">RGB on stairs that is boring</h1>

<p>Is what you might think. But let’s spice it up a bit by making them user aware. Okay, let’s put a motion sensor nearby and this activated the lights when you are in the vicinity. Well… no it can be even cooler, how about making it stair-step-aware?!</p>

<h2 id="stair-step-awareness">stair-step-awareness</h2>

<p>Wouldn’t it be cool if the stairs would light up exactly on your current step? I think it would be and that is exactly the goal of today. Towards this, I designed a custom system that adds some flair to your stairs! It consists of three main components,</p>

<ul>
  <li>Addressable RGB led-strip</li>
  <li>Step presence detection</li>
  <li>Controller</li>
</ul>

<h1 id="addressable-rgb-led-strip">Addressable RGB led-strip</h1>

<p>To look cool I didn’t opt for just a white led-strip but an RGB one that is individually addressable, because we want to do cool things with it… Such as stair-step awareness (SSA). Our stairs have 12 steps each of approximate length of 1 meter. This means I need 12 meters of LED strip, luckily due to mass fabrication these can be and are quite cheap, but what should one choose? It depends on a few factors but I mainly concentrated on,</p>

<h2 id="voltage-drop-on-an-rgb-led-strip-and-my-choice">Voltage drop on an RGB led-strip and my choice</h2>

<p>The main factor to consider here is that at 12 meters in length the voltage drop can be quite significant, hence choosing LED chips that work with a higher operation voltage are more convenient to use. Why is this? Consider for similar LED efficiency (the same amount of energy is required to give a certain amount of light), the power is constant then for LED with higher operation voltage less current is required. Then by Ohm’s law \(V_{drop} = I^2R\) is lower for LEDs with higher operating voltage. This means the LED strip will not become dim over its length. Additionally, one could opt to connect the power source at regular intervals on the total LED strip, however this requires additional wire and floor planning. Therefore, it is better to choose a more suitable LED strip. The most common options are, 5 V and 12 V. Since 5 V is the lowest option here, 12 V is preferred because of the lower voltage drop. This made my choice to fall on the WS2811 the higher voltage brother of the WS2812B which is common in <a href="https://hackaday.io/projects?tag=ws2812">many projects</a>.</p>

<h2 id="brightness-trueness-of-color-and-power-consumption-etc">Brightness, trueness of color and power consumption, etc.</h2>

<p>In the end there are <a href="https://www.waveformlighting.com/led-strip-lights">many more factors</a> to consider. Some LED strips are better in some of the factors but in the end the <a href="https://www.aliexpress.com/item/2000165819.html?spm=a2g0o.productlist.0.0.3fe63e9dY7W9gl&amp;algo_pvid=7d31ef6a-f8cb-4983-8fcb-fd3d554a5a0c&amp;algo_exp_id=7d31ef6a-f8cb-4983-8fcb-fd3d554a5a0c-0&amp;pdp_ext_f=%7B%22sku_id%22%3A%2210000000953811077%22%7D&amp;pdp_npi=2%40dis%21EUR%21%2114.66%21%21%21%21%21%402100bdf116538193387373611e2f44%2110000000953811077%21sea">WS2811</a> was the cheapest per meter and suited my needs. Some alternatives are, <a href="https://www.aliexpress.com/item/32476317187.html">SK6812</a> and <a href="https://www.aliexpress.com/item/32322326979.html">APA102</a>.</p>

<h1 id="step-presence-detection">Step presence detection</h1>

<p>To achieve the SSA, we need to somehow know when someone is on a step. Let’s consider some mechanics and imagine you are standing on a stair-step. When you step on a step, your foot is on the step. This induces pressure but also your foot is physically there. I came up with the two following mechanisms to detect the presence on a certain step.</p>

<ul>
  <li>Light-blocking</li>
  <li>Pressure</li>
</ul>

<h2 id="light-blocking">Light-blocking</h2>

<p>When your foot is on the step it is physically there. This means if there is a light sensor it would be blocked off by your foot. This could be sideways or in the step itself as depicted here. <img src="C:\Users\draakje\AppData\Roaming\Typora\typora-user-images\image-20220522161715073.png" alt="image-20220522161715073" /></p>

<p>These methods have a few cons, for <em>sideways</em> you would require an additional light source. For <em>in</em> you can use your natural lighting such as diffuse light, however, this would not work very well at night. Also, the intensity can vary over the day so you would need some automatic calibration to distinguish between low light or ‘is being stepped on’ conditions.</p>

<h2 id="pressure">Pressure</h2>

<p>Since the light-blocking method is possible. I deemed it too complex to do, so I thought of an alternative. Where I use pressure sensors and with this in my I went ahead and found two types of pressure sensors</p>

<ul>
  <li>Strain-gauge</li>
  <li>Thin-film pressure sensor</li>
</ul>

<p>The strain gauge required me to glue them on the backside of the stairs. In that way, it can bend together with the wood and hence measure presence. This required a lot of glue and modifications so I did not prefer this.</p>

<p>Whereas thin films can be placed very unobtrusively onto the stair-step. Since we were planning to use stair nosings profiles, they could be perfectly hidden underneath them. These sensors have huge resistance and once it compresses the resistance decreases. So the controller needs to read the resistance in some smart way to detect presence. More on that below…</p>

<h1 id="controller">Controller</h1>

<p>In this project I needed two main functionalities to be achieved by this controller.</p>

<p>1) The controller knows which step I am standing on, SSA
2) Correct color is sent to the RGB led-strip</p>

<p>One of the most known microcontrollers is the Arduino since it is so popular a lot of libraries are created for it and this makes my life a lot easier. Less time spent on re-inventing the wheel is more time to do cool projects. But, not only software is needed but also hardware since we are using real physical sensors.</p>

<h2 id="thin-film-pressure-sensor-readout">Thin-film pressure sensor readout</h2>

<p>The circuitry that is used is very simple, there are two states. Either you are on the step or you are not on the step. These two states can be distinguished by looking at the resistance of the sensor, this means we need to distinguish between high and low resistance states. As mentioned before the resistance decreases if it is compressed hence it makes sense to choose everything below a certain threshold, that is the <em>on the step</em> state and everything above is <em>not on the step</em> state.</p>

<h2 id="comparator-to-sense-the-state">Comparator to sense the state</h2>

<p>To achieve state readout we can use a comparator, which can be explained with the following <a href="https://en.wikipedia.org/wiki/Comparator">image</a>,</p>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/f/f5/Opamp105.gif" alt="Comparator - Wikipedia" /></p>

<p>It basically does what I explained before, if you use a 5 V supply it makes sense to set \(V_{REF} = 2.5V\) and thus choose the resistors equally. However, since I have 12 steps I have to do this 12x?</p>

<h2 id="time-multiplexing-is-less-hardware">Time multiplexing is less hardware</h2>

<p>Since OPAMPs are not very cheap ~ €1,- a piece and the number of control pins on the Arduino is limited I chose to do time multiplexing. In time-multiplexing I make use of the fact that I don’t need to constantly know whether someone is <em>on the step</em>, but only once in a while. The Arduino’s clock frequency is 32 MHz so I could read out my stairs at MHz speeds which means million times per second. But I don’t need to know it that often hence I could easily divide this by 12 and read all 12 steps with time multiplexing.</p>

<h2 id="electronics-schema-for-led-controller-pcb">Electronics schema for LED controller PCB</h2>

<p>To achieve all of the hardware functionalities I created a small PCB that neatly packs everything together, with its schema below</p>

<p><img src="https://raw.githubusercontent.com/shikon/cloudimg/master/typora/image-20220529124522662.png" alt="image-20220529124522662" /></p>

<p>A few things to note from left to right and up to down.</p>

<ul>
  <li>I used a <a href="https://www.aliexpress.com/item/4000016331112.html">DC-DC converter</a> so I could use a single supply for LED and my controller PCB.</li>
  <li>Some external connector to connect to the LED strip and also control a relay if needed</li>
  <li>Time multiplexing where W0-W11 are the pressure sensors and IC1 is the multiplexing chip</li>
  <li>Biasing for the comparator circuit achieved with OPAMP
    <ul>
      <li>R4 series resistor to prevent short circuits of the weight sensor</li>
      <li>R1 is a pulldown resistor</li>
    </ul>
  </li>
  <li>The Arduino, pro mini because it is <a href="https://www.aliexpress.com/item/1005003822653479.htm">cheap</a></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
**NOTE**
The labels with same name means they are connected together
---
</code></pre></div></div>

<h2 id="arduino-code-for-controller">Arduino code for controller</h2>

<p>To make everything work together of course code is needed. So the software has these functionalities, when the presence is detected it turns all the lights on to <code class="language-plaintext highlighter-rouge">CRGB on(122,122,122)</code>. The step above your current step will be set to <code class="language-plaintext highlighter-rouge">CRGB stepColordown(255,0,0)</code> and the step below your current step will be <code class="language-plaintext highlighter-rouge">CRGB stepColorup(0,255,0)</code>. After it turns on and the presence is gone, it will fade to <code class="language-plaintext highlighter-rouge">CRGB bgColor( 122, 122, 122)</code> and after 15 seconds it will fade to no light <code class="language-plaintext highlighter-rouge">CRGB off(0,0,0)</code>.</p>

<p>The main things to change to your needs is in the first few lines,</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;Arduino.h&gt;
#include "FastLED.h"
#include "Mux.h"
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">admux</span><span class="p">;</span>

<span class="c1">// Hardware settings CHANGE THIS</span>
<span class="cp">#define NUM_LEDS 16 //number leds per step (16)
#define NUM_STEPS 12 //number of steps
#define STOP_TIME 15000 //after this time turn it off
</span>
<span class="c1">//init mux object</span>
<span class="n">Mux</span> <span class="nf">mux</span><span class="p">(</span><span class="n">admux</span><span class="o">::</span><span class="n">Pin</span><span class="p">(</span><span class="n">A0</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">,</span> <span class="n">PinType</span><span class="o">::</span><span class="n">Analog</span><span class="p">),</span> <span class="n">Pinset</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span> <span class="c1">// need admux:: because pin doubly defined</span>

<span class="cp">#define detectPin 14 // pin connected to output of comparator/OPAMP
#define enPin 17 //pin for relay
#define DATA_PIN 9 //pin that is connected to led strip
</span>
<span class="cp">#define TOT_LEDS NUM_LEDS*NUM_STEPS
</span>
<span class="c1">//time keepers</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">CRGB</span> <span class="n">leds</span><span class="p">[</span><span class="n">TOT_LEDS</span><span class="p">];</span>
<span class="c1">//set your colors</span>
<span class="n">CRGB</span> <span class="nf">stepColordown</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">CRGB</span> <span class="nf">stepColorup</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">CRGB</span> <span class="nf">bgColor</span><span class="p">(</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">122</span><span class="p">);</span> <span class="c1">//white</span>
<span class="n">CRGB</span> <span class="nf">off</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">CRGB</span> <span class="nf">on</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">122</span><span class="p">);</span>
<span class="c1">// NO CHANGES NEEDED BELOW except color order in setup()</span>
<span class="kt">int</span> <span class="n">detected</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">channelDetected</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Helper function that blends one uint8_t toward another by a given amount</span>
<span class="kt">void</span> <span class="nf">nblendU8TowardU8</span><span class="p">(</span> <span class="kt">uint8_t</span><span class="o">&amp;</span> <span class="n">cur</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">target</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">amount</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">cur</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span> <span class="n">cur</span> <span class="o">&lt;</span> <span class="n">target</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">cur</span><span class="p">;</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">scale8_video</span><span class="p">(</span> <span class="n">delta</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="n">cur</span> <span class="o">+=</span> <span class="n">delta</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="n">target</span><span class="p">;</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">scale8_video</span><span class="p">(</span> <span class="n">delta</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="n">cur</span> <span class="o">-=</span> <span class="n">delta</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Blend one CRGB color toward another CRGB color by a given amount.</span>
<span class="c1">// Blending is linear, and done in the RGB color space.</span>
<span class="c1">// This function modifies 'cur' in place.</span>
<span class="n">CRGB</span> <span class="nf">fadeLedtoColor</span><span class="p">(</span> <span class="n">CRGB</span><span class="o">&amp;</span> <span class="n">cur</span><span class="p">,</span> <span class="k">const</span> <span class="n">CRGB</span><span class="o">&amp;</span> <span class="n">target</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">amount</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">nblendU8TowardU8</span><span class="p">(</span> <span class="n">cur</span><span class="p">.</span><span class="n">red</span><span class="p">,</span>   <span class="n">target</span><span class="p">.</span><span class="n">red</span><span class="p">,</span>   <span class="n">amount</span><span class="p">);</span>
  <span class="n">nblendU8TowardU8</span><span class="p">(</span> <span class="n">cur</span><span class="p">.</span><span class="n">green</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">green</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
  <span class="n">nblendU8TowardU8</span><span class="p">(</span> <span class="n">cur</span><span class="p">.</span><span class="n">blue</span><span class="p">,</span>  <span class="n">target</span><span class="p">.</span><span class="n">blue</span><span class="p">,</span>  <span class="n">amount</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">cur</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Fade an entire array of CRGBs toward a given background color by a given amount</span>
<span class="c1">// This function modifies the pixel array in place.</span>
<span class="kt">void</span> <span class="nf">fadeSteptoColor</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">step</span><span class="p">,</span> <span class="n">CRGB</span><span class="o">*</span> <span class="n">L</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">N</span><span class="p">,</span> <span class="k">const</span> <span class="n">CRGB</span><span class="o">&amp;</span> <span class="n">bgColor</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">fadeAmount</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span> <span class="c1">// N is number of leds per step to fade</span>
    <span class="n">fadeLedtoColor</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">step</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="n">bgColor</span><span class="p">,</span> <span class="n">fadeAmount</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">fadeAllstepsTocolor</span><span class="p">(</span><span class="n">CRGB</span><span class="o">*</span> <span class="n">L</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">N</span><span class="p">,</span> <span class="k">const</span> <span class="n">CRGB</span><span class="o">&amp;</span> <span class="n">bgColor</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">fadeAmount</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">noofsteps</span><span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">uint16_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">noofsteps</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">fadeSteptoColor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">bgColor</span><span class="p">,</span> <span class="n">fadeAmount</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">readChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">chnl</span><span class="p">){</span>
  <span class="kt">int16_t</span> <span class="n">data</span><span class="p">;</span>

  <span class="n">mux</span><span class="p">.</span><span class="n">channel</span><span class="p">(</span><span class="n">chnl</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">//don't need full speed let it settle</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">mux</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Potentiometer at channel "</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">chnl</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" is at "</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="kt">double</span><span class="p">)</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">1023</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"%%"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">511</span><span class="p">)</span> <span class="k">return</span> <span class="n">chnl</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">changeSteplight</span><span class="p">(</span><span class="kt">int</span> <span class="n">step</span><span class="p">,</span> <span class="n">CRGB</span><span class="o">&amp;</span> <span class="n">color</span><span class="p">){</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">NUM_LEDS</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
    <span class="n">leds</span><span class="p">[</span><span class="n">step</span><span class="o">*</span><span class="n">NUM_LEDS</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setAllotherSteps</span><span class="p">(</span><span class="kt">int</span> <span class="n">mystep</span><span class="p">,</span> <span class="n">CRGB</span> <span class="n">myColor</span><span class="p">){</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">mystep</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">&lt;</span><span class="n">NUM_STEPS</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
    <span class="n">changeSteplight</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="n">myColor</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
    <span class="n">changeSteplight</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">,</span><span class="n">myColor</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setAllsteps</span><span class="p">(</span><span class="kt">int</span> <span class="n">mystep</span><span class="p">,</span> <span class="n">CRGB</span> <span class="n">myColor</span><span class="p">){</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">changeSteplight</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">myColor</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">enPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">detectPin</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">enPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">FastLED</span><span class="p">.</span><span class="n">addLeds</span><span class="o">&lt;</span><span class="n">WS2811</span><span class="p">,</span> <span class="n">DATA_PIN</span><span class="p">,</span> <span class="n">BRG</span><span class="o">&gt;</span><span class="p">(</span><span class="n">leds</span><span class="p">,</span> <span class="n">TOT_LEDS</span><span class="p">);</span> <span class="c1">//set your color order for me BRG</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">channelDetected</span> <span class="o">=</span> <span class="n">readChannel</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">channelDetected</span><span class="p">){</span>
      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span> <span class="c1">//T</span>
      <span class="n">detected</span><span class="o">++</span><span class="p">;</span>
      <span class="n">start</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
      <span class="n">setAllsteps</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">bgColor</span><span class="p">);</span>
      <span class="n">changeSteplight</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">stepColordown</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">channelDetected</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="n">changeSteplight</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">stepColorup</span><span class="p">);</span> <span class="c1">//note that if channeldetected = 1, i = 0</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">detected</span><span class="p">){</span>
    <span class="n">fadeAllstepsTocolor</span><span class="p">(</span><span class="n">leds</span><span class="p">,</span> <span class="n">NUM_LEDS</span><span class="p">,</span> <span class="n">bgColor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">STOP_TIME</span><span class="p">){</span> <span class="c1">// keep lights on for set time</span>
    <span class="n">detected</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">//FastLED.clear(); // hard turn off</span>
    <span class="n">fadeAllstepsTocolor</span><span class="p">(</span><span class="n">leds</span><span class="p">,</span> <span class="n">NUM_LEDS</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NUM_STEPS</span><span class="p">);</span> <span class="c1">//soft turn off</span>
  <span class="p">}</span>
  <span class="n">FastLED</span><span class="p">.</span><span class="n">show</span><span class="p">();</span> 
<span class="p">}</span>
</code></pre></div></div>

<h1 id="final-words">Final words</h1>

<p>Well enjoy that all :)</p>

<h1 id="learnings-and-references">Learnings and references</h1>

<ul>
  <li>Consider not only the number stair-step but also one more which is even to the floor.</li>
  <li>It is a pain to make so many long connectors, 12 sensors…</li>
</ul>

<p><a href="https://gist.github.com/kriegsman/d0a5ed3c8f38c64adcb4837dafb6e690">The blending function</a></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#arduino" class="page__taxonomy-item" rel="tag">Arduino</a><span class="sep">, </span>
    
      <a href="/tags/#smart-home" class="page__taxonomy-item" rel="tag">Smart Home</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#programming" class="page__taxonomy-item" rel="tag">programming</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-05-22T00:00:00+02:00">May 22, 2022</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=RGB+lights+even+on+your+stairs%20https%3A%2F%2Fshiko.nl%2Fprogramming%2Fpressure_RGB_stairs%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fshiko.nl%2Fprogramming%2Fpressure_RGB_stairs%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fshiko.nl%2Fprogramming%2Fpressure_RGB_stairs%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/programming/update-ha-2021/" class="pagination--pager" title="Can’t update home assistant to latest version because of RUST
">Previous</a>
    
    
      <a href="/electronics/pcb_graduation/" class="pagination--pager" title="A secret BOM tool used for my PCB assembly
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/electronics/pcb_graduation/" rel="permalink">A secret BOM tool used for my PCB assembly
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Exploring PCB Design Tools: A interactive BOM tool for EAGLE

Introduction
When it comes to PCB design, choosing the right software tool is crucial for effic...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/programming/update-ha-2021/" rel="permalink">Can’t update home assistant to latest version because of RUST
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Can’t update home assistant with rust

I kept getting the issue,  error: can’t find Rust compiler on my truenas box. After looking everywhere and trying vari...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/programming/shibee-stick-flash/" rel="permalink">ShiBee stick flashing and teardown
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">To make or not to make a shtick

A recent design of a ZigBee stick

As mentioned before, I had issues with my old ZigBee stick. Also due to low inventory, be...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/programming/espeasy-restart/" rel="permalink">Automatic restart ESP8266 with ESP easy
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">A smart home with issues

Recently, I had the issue where my ZigBee network would die every few days. After a lot of debugging and even re-pairing of all my ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="search-searchbar"></div>
  <div class="search-hits"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/shikon" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/lanhu" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Lan Hu. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>


<!-- Including InstantSearch.js library and styling -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'L6XIHWOGZ2',
  apiKey: '43db23cbf486a7a95d34883d3391bdab',
  indexName: 'blog',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate,
      empty: 'No results',
    }
  })
);

// Starting the search only when toggle is clicked
$(document).ready(function () {
  $(".search__toggle").on("click", function() {
    if(!search.started) {
      search.start();
    }
  });
});
</script>









<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" defer
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


  </body>
</html>
